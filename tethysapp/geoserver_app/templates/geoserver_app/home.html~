{# % extends "tethys_apps/app_header_content.html" % #}
{% extends "geoserver_app/base.html" %}

{% load static tethys_gizmos %}
{% load tethys_gizmos %}

{% block inner_app_content %}

  <div id="inner-app-content" class="container-fluid">
    
    <form method="post">
     
     <div class="row" style="height:100%;">
    
	    <div class="col-md-6" style="max-height:100%;overflow: auto;">
		    {# left column content #}
	        {% block app_content_lc %}
	          <!--form method="post"-->
                {% csrf_token %}
                <table style="width:100%">
                  <tr>
                    <td>
                      {% gizmo select_input eo_select_options %}
                    </td>
                    <td>
                      {% gizmo select_input eo_years_options %}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      {% gizmo select_input eo_months_options %}
                    </td>
                    <td>
                      {% gizmo select_input eo_dekads_options %}
                    </td>
                  </tr>
                </table>

                <div id="eo_message" message="{{ eo_layers }}"></div>

                <!-- input name="eo_submit" type="submit" value="Update Map" class="btn btn-default" style="width:15%;" -->
                
               <!--/form-->
              {# % gizmo eo_map_options % #}

	          <div id="map_eo" class="map">
	        </div>

	        <div id="my-attributes" 
	           data-eo-layers="{{ eo_layers }}"
	           data-eo-geoserver-url="{{ eo_geoserver_url }}"
	           data-eo-time="{{ geoe5_time }}"
	           >
	        </div>
	          
	          <script>

				var eo_layers = $('#my-attributes').data('eo-layers');
				var eo_geoserver_url = $('#my-attributes').data('eo-geoserver-url');
				var geoe5_time = $('#my-attributes').data('geoe5-time');
				
				console.log('EO LAYERS: ', eo_layers);
				console.log('EO GEOSERVER URL: ', eo_geoserver_url);
				console.log('EO TIME: ', geoe5_time);
				
				eo_layers_test = {'LAYERS': eo_layers};
				if (eo_layers.includes('emodis')) {
					eo_layers_test = {'LAYERS': eo_layers, 'TIME':geoe5_time};
					console.log('EMODIS time:', geoe5_time);
				}
				
				var map = new ol.Map({
				  target: 'map_eo',
				  layers: [
					new ol.layer.Tile({
					  source: new ol.source.OSM(),
					}),
					new ol.layer.Image({
					  source: new ol.source.ImageWMS({
						url: eo_geoserver_url,
						//url: 'https://chc-ewx2.chc.ucsb.edu:8443/geoserver/wms',
						params: eo_layers_test,
						//params: {'LAYERS': eo_layers},
						//url: 'https://dmsdata.cr.usgs.gov/geoserver/wms',
						//params: {'LAYERS': eo_layers, 'TIME':'2020-08-01', 'jsonLayerId':'emodisndvic6v2_africa_dekad_data', 'STYLES':'fews_emodis_dekad_data_raster_ngviewer' },
						serverType: 'geoserver',
					  }),
					}), 
				  ],
				  view: new ol.View({
					center: ol.proj.fromLonLat([41, 0]),
					zoom: 5.5
				  })
				});
	          
	          </script>
              <div style="position:relative; left:0; top:0; z-index:1500">
	              <img src="{{ eo_legend_url }}"></img>
	          </div>

            {% endblock %}
	    </div>
	 	    
	    <div class="col-md-6" style="max-height:100%;overflow: auto;">
		  {# right column content #}
	      {% block app_content_rc %}
	          <!--form method="post"-->
                {% csrf_token %}
                <table style="width:100%">
                  <tr>
                    <td>
                      {% gizmo select_input forecast_select_options %}
                    </td>
                    <td>
                      {% gizmo select_input forecast_season_options %}
                    </td>
                    <td>
                      {% gizmo select_input forecast_years_options %}
                    </td>
                  </tr>
                  <tr>
                    <td>
                      {% gizmo select_input forecast_months_options %}
                    </td>
                    <td>
                      {% gizmo select_input forecast_dekads_options %}
                    </td>
                  </tr>
                </table>
                <!-- input name="forecast_submit" type="submit" value="Update Map" class="btn btn-default" -->
              <!--/form-->

              <div id="forecast_message" message=""></div>

              {# % gizmo forecast_map_options % #}
	          <div id="map" class="map"></div>

	          <div id="my-attributes1" data-forecast-sld="{{ forecast_sld_file }}"></div>
	          
	          <script>
	          
				var forecast_sld_file = $('#my-attributes1').data('forecast-sld');
				console.log('Forecast SLD: ', forecast_sld_file);
				document.getElementById("forecast_message").innerHTML = "{{ forecast_sld_file }}";
				document.getElementById("eo_message").innerHTML = "{{ eo_layers }}";
				
				var map = new ol.Map({
				  target: 'map',
				  layers: [
					new ol.layer.Tile({
					  source: new ol.source.OSM(),
					}),
					new ol.layer.Image({
					  source: new ol.source.ImageWMS({
						url: 'https://chc-ewx2.chc.ucsb.edu:8443/geoserver/wms',
						params: {'SLD': forecast_sld_file },
						serverType: 'geoserver',
					  }),
					}), 
				  ],
				  view: new ol.View({
					center: ol.proj.fromLonLat([41, 0]),
					zoom: 5.5
				  })
				});
	          </script>

	          <!-- <script src='main.js'> </script> -->
              <div style="position:relative; left:0; top:0; z-index:1500">
	              <img src="{{ forecast_legend_url }}"></img>
	          </div>
	


	      {% endblock %}
	    </div>
	    
    </div>
    <br>
    <br>
    <input name="update_maps" type="submit" value="Update Maps" class="btn btn-default" style="width:15%;">
    </form>
  </div>
{% endblock %}
